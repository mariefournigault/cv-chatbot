import streamlit as st
from openai import OpenAI
import os

# üîê R√©cup√©ration s√©curis√©e de la cl√© API
client = OpenAI(api_key=os.environ["OPENAI_API_KEY"])

# -------- TON CV -------- #

CV = """
Nom : Marie Fournigault
M√©tier : Cheffe de projets d√©veloppement produit

Objectif : √©voluer vers un poste de Product Owner ou Chef de projet IT.

Exp√©riences majeures :
- Cheffe de projets d√©veloppement produit chez Cartier : pilotage complet des nouvelles collections (qualit√©, co√ªts, d√©lais, risques).
- Planificatrice senior : management de juniors, pilotage charge/capacit√©, d√©ploiement d‚Äôun module SAP.
- Cheffe de projets logistiques : +18% de taux de service, d√©ploiement d‚Äôemballages r√©utilisables (200K plastiques √©conomis√©s/an).
- Exp√©rience internationale : Italie et Roumanie.

Comp√©tences :
SAP, planification, gestion de projets, Power BI, Lean, supply chain, VBA.

Soft skills :
Leadership, organisation, analyse, autonomie.
"""

# -------- PROMPT IA -------- #

SYSTEM_PROMPT = """
Tu es un assistant professionnel charg√© de r√©pondre aux recruteurs.

OBJECTIF :
Mettre en valeur le profil de Marie Fournigault de mani√®re honn√™te et professionnelle.

R√àGLES IMPORTANTES :

- R√©ponds UNIQUEMENT aux questions professionnelles.
- Si une question est personnelle (√¢ge, situation familiale, adresse, religion, politique, salaire, etc),
r√©ponds :

"Je pr√©f√®re me concentrer sur les √©l√©ments professionnels du profil."

- Ne jamais inventer.
- Reste synth√©tique.
- Ton ton doit √™tre naturel et humain (pas robotique).

Voici le profil :

""" + CV


# -------- FONCTION CHAT -------- #

def ask_ai(messages):

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=messages,
        temperature=0.4
    )

    return response.choices[0].message.content


# -------- INTERFACE -------- #

st.set_page_config(
    page_title="CV interactif - Marie Fournigault",
    page_icon="üí¨",
    layout="centered"
)

st.title("üí¨ CV interactif")
st.write("Posez une question sur mon parcours professionnel.")

# M√©moire de conversation
if "messages" not in st.session_state:
    st.session_state.messages = [
        {"role": "system", "content": SYSTEM_PROMPT}
    ]

# Affichage historique
for msg in st.session_state.messages[1:]:
    with st.chat_message(msg["role"]):
        st.write(msg["content"])

# Input utilisateur
if prompt := st.chat_input("Votre question..."):

    st.session_state.messages.append(
        {"role": "user", "content": prompt}
    )

    with st.chat_message("user"):
        st.write(prompt)

    with st.chat_message("assistant"):

        response = ask_ai(st.session_state.messages)

        st.write(response)

    st.session_state.messages.append(
        {"role": "assistant", "content": response}
    )
